name: Tic tac toe CI/CD 

on:
  push:
    branches:
      - '*'

env:
  LOGIN: ${{ secrets.DOCKER_LOGIN }}
  PASSWORD: ${{ secrets.DOCKER_PWD }}
  IMAGE_TAG: ${GITHUB_REF:11}
  
jobs:
  test:
    runs-on: [ubuntu-latest]
    name: Running tests
    steps:
    - uses: actions/checkout@master
    - uses: actions/setup-python@v1
      with:
        python-version: '3.10'
    - name: Install requirements
      run: pip install -r requirements.txt
    - name: Run test
      run: |
          python manage.py test
          echo "Tests worked successfully"
  build_publish:
    runs-on: [ubuntu-latest]
    name: Build
    steps:
    - name: Login to docker.io
      run:  echo ${{ secrets.DOCKER_PWD }} | docker login -u ${{ secrets.DOCKER_LOGIN }} --password-stdin
    - uses: actions/checkout@master
    - name: Build docker compose
      run:  docker-compose build --parallel ${{ secrets.DOCKER_NAME }} .
      
